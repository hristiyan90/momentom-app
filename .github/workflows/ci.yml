name: CI Clean

on:
  pull_request:
    branches: [ main ]

jobs:
  openapi:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      - name: OpenAPI validate
        run: npx --yes @apidevtools/swagger-cli@4.0.4 validate openapi/momentom_api_openapi_1.0.1.yaml

  basic-test:
    runs-on: ubuntu-latest
    needs: openapi
    steps:
      - uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'
      - name: Install deps
        run: npm ci
      - name: Test basic API endpoints
        run: |
          echo "Testing basic API functionality..."
          
          # Test health endpoint
          echo "Testing health endpoint..."
          curl -s "https://v0-endurance-app-ui.vercel.app/api/health/env" | jq || echo "Health endpoint test failed"
          
          # Test with auth header
          echo "Testing plan endpoint with auth..."
          curl -s -H "X-Athlete-Id: 00000000-0000-0000-0000-000000000001" \
            "https://v0-endurance-app-ui.vercel.app/api/plan" | jq || echo "Plan endpoint test failed"
          
          echo "Basic API tests completed"
